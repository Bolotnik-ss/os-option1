# Защита от несанкционированного запуска системы

Этот проект реализует защиту от несанкционированного запуска операционной системы Linux через проверку наличия USB-накопителя с уникальным серийным номером в процессе загрузки.

## Предварительные требования

Перед установкой убедитесь, что у вас есть следующие компоненты:

- Операционная система Linux (на базе Debian/Ubuntu).
- Установлены утилиты для работы с `initramfs`, такие как `initramfs-tools`.
- Доступ к правам суперпользователя (root) для модификации загрузчика и скриптов.
- USB-флеш-накопитель с уникальным серийным номером, который будет использоваться для проверки.

## Шаги установки

### Шаг 1: Клонирование репозитория

Склонируйте репозиторий с исходным кодом скрипта:

```bash
git clone https://github.com/Bolotnik-ss/os-option1.git
cd os-option1
```

### Шаг 2: Получение серийного номера USB-накопителя

1. Подключите флеш-накопитель к одному из USB-портов вашего компьютера.
2. Откройте терминал и выполните команду:
   
   ```bash
   lsusb
   ```
   Это покажет список всех подключенных USB-устройств, например:

   ```bash
   Bus 002 Device 003: ID 1234:abcd Example USB Flash Drive
   ```

3. Чтобы узнать серийный номер устройства, используйте команду:

   ```bash
   sudo lsusb -v -d 1234:abcd | grep iSerial
   ```

   Замените `1234:abcd` на идентификатор вашего устройства из вывода команды `lsusb`. Вы получите строку:

   ```bash
   iSerial                 3 1234567890ABCDEF
   ```

   Скопируйте серийный номер устройства, так как он потребуется для настройки скрипта.

### Шаг 3: Редактирование скрипта

1. Откройте файл скрипта `option1.sh` для редактирования:

   ```bash
   nano option1.sh
   ```

2. Найдите строку с серийным номером:

   ```bash
   REQUIRED_SERIAL="5FD325C5E8AF4A8D"
   ```

3. Замените значение `5FD325C5E8AF4A8D` на серийный номер вашего флеш-накопителя.

4. Сохраните изменения и выйдите из редактора (для сохранения: `Ctrl + O`, затем `Enter`, для выхода: `Ctrl + X`).

### Шаг 4: Копирование скрипта в нужную директорию

1. Скопируйте скрипт в каталог `/etc/initramfs-tools/scripts/init-bottom/`:

   ```bash
   sudo cp option1.sh /etc/initramfs-tools/scripts/init-bottom/
   ```

2. Убедитесь, что скрипт имеет права на выполнение:

   ```bash
   sudo chmod +x /etc/initramfs-tools/scripts/init-bottom/option1.sh
   ```

### Шаг 5: Пересборка initramfs

Пересоберите `initramfs`, чтобы изменения вступили в силу:

```bash
sudo update-initramfs -u
```

### Шаг 6: (При необходимости) Обновление конфигурации GRUB

Если вы не видите текстовые сообщения при загрузке системы и видите только графический интерфейс загрузчика, выполните следующие шаги:

1. Откройте файл конфигурации GRUB для редактирования:

   ```bash
   sudo nano /etc/default/grub
   ```

2. Убедитесь, что строка `GRUB_CMDLINE_LINUX_DEFAULT` выглядит так:

   ```bash
   GRUB_CMDLINE_LINUX_DEFAULT=""
   ```

3. Сохраните изменения и обновите конфигурацию GRUB:

   ```bash
   sudo update-grub
   ```

## Использование

1. При следующей загрузке системы, если нужный USB-накопитель не будет подключен, загрузка будет приостановлена на 30 секунд, и на экране отобразится сообщение с обратным отсчетом. По истечении времени система автоматически выключится.
2. Если флеш-накопитель будет подключен до завершения таймера, таймер остановится, и система продолжит загрузку в штатном режиме.

## Удаление скрипта и восстановление состояния

Если вам нужно удалить скрипт и вернуть систему в прежнее состояние:

1. Удалите скрипт из каталога initramfs:

   ```bash
   sudo rm /etc/initramfs-tools/scripts/init-bottom/option1.sh
   ```

2. Пересоберите `initramfs`:

   ```bash
   sudo update-initramfs -u
   ```

3. (При необходимости) Восстановите параметры `quiet splash` в конфигурации GRUB и пересоберите его:

   ```bash
   sudo nano /etc/default/grub
   ```

   Вставьте обратно:

   ```bash
   GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
   ```

   Затем обновите конфигурацию:

   ```bash
   sudo update-grub
   ```

## Решение проблем

- **Не отображается сообщение при отсутствии флеш-накопителя**: Убедитесь, что вы удалили параметры `quiet splash` в конфигурации GRUB и обновили конфигурацию с помощью `update-grub`.
- **USB-накопитель не распознается**: Проверьте настройки скрипта и убедитесь, что серийный номер устройства совпадает с тем, который указан в конфигурации скрипта.
